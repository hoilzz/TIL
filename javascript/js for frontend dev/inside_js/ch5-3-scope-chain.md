# 스코프 체인

여기서부터 AO = VO 로 통일하여 사용한다.

scope chain을 이해하면,

변수에 대한 인식 메커니즘을 알 수 있다.

또한, 현재 사용되는 변수가 어디에서 선언된 변수인지 정확히 알 수 있다.

---

JS도 다른 언어와 마찬가지로 스코프, 즉 `유효 범위`가 있다.

이 유효 범위 안에서 변수와 함수가 존재한다.

JS는 오직 함수 만 유효 범위의 한 단위이다.

(C 코드 처럼 함수,if,for문을 한 블록으로 접근하지 않는다.)


---

*스코프체인*

|index| VO |
|:---:|:---:|
|3|....|
|2|VO 2|
|1|VO 1|
|0|VO 0|

**각 함수는 생성될 때, `[[scope]]` 프로퍼티로 자신이 생성된 실행 컨텍스트의 스코프 체인을 참조한다.**

**함수가 실행되는 순간 실행 컨텍스트가 만들어진다.**

**이 실행 컨텍스트는 실행된 함수의 `[[scope]]` 프로퍼티를 기반으로 새로운 스코프체인 만든다.**


## 5.3.1 전역 실행 컨텍스트의 스코프 체인

전역 실행 컨텍스트 생성시, VO 생성된다.

이 VO의 스코프체인은?

현재 전역 실행 컨텍스트 단 하나만 실행되기 때문에 참조할 상위 컨텍스트가 없다.


## 5.3.2 함수를 호출한 경우 생성되는 실행 컨텍스트의 스코프 체인

```javascript
var var1=1;
function func(){
	var var1=10;
	console.log(var1);
}
func();
console.log(var1);
```

전역 실행 컨텍스트 생성되고, `func()` 함수 객체가 만들어진다.

이 함수 객체의 `[[scope]]`는 ??

**함수 객체가 생성될 때**,
그 함수 객체의 `[[scope]]`**는 현재 실행되는 컨텍스트의 변수 객체에 있는 `[[scope]]`를 그대로 가진다**.

따라서 `func()`의 `[[scope]]` 프로퍼티는 전역 변수 객체가 된다.

```javascript
func();
```

함수를 실행하면, 새로운 컨텍스트 생성된다.

func 컨텍스트의 스코프 체인은 실행된 함수의 `[[scope]]` 프로퍼티를 그대로 복사한다.

그리고 현재 생성된 VO를 복사한 스코프 체인의 맨앞에 추가한다.

---

요약하면,

- 각 함수 객체는 `[[scope]]`프로퍼티로 현재 컨텍스트의 스코프 체인을 참조한다.

- 함수 실행시, 새로운 실행 컨텍스트 만든다. 이 실행 컨텍스트는 자신이 사용할 스코프 체인을 다음 방법으로 만든다. 현재 실행되는 함수 객체의 `[[scope]]` 프로퍼티를 복사하고, 새롭게 생성된 VO를 해당 체인의 제일 앞에 추가하나다.

즉, 스코프체인 = 현재 실행 컨텍스트의 변수 객체 + 현재 실행 컨텍스트를 생성한 함수 객체의 스코프 체인


---

실행 컨텍스트가 만들어지면서 스코프 체인 형성 방법을 알아보았다.

스코프 체인을 통해 식별자 인식이 이뤄진다.

---

> 호이스팅
```javascript
foo();
bar();

var foo = function(){
	console.log("foo and x = "+x);
}
function bar(){
	console.log("bar and x = " + x);
}
var x = 1;
```

위 예제는 다음과 같다.

```javascript
var foo;

function bar(){
	console.log("bar and x = " + x);
}

var x;

foo() // TypeError
bar();

foo = function(){
	console.log("foo and x = " + x);
}

x = 1;
```


## summary

scope chain을 이해하면, **변수에 대한 인식 메커니즘**을 알 수 있다.

JS의 스코프 즉, 유효 범위는 함수 단위다.

각 함수는 생성될 때, `[[scope]]` 프로퍼티로 자신이 생성된 실행 컨텍스트의 스코프 체인을 참조한다.

함수가 실행되는 순간 실행 컨텍스트 만들어진다.

이 때 실행 컨택스트의 `[[scope]]`는 실행된 함수의 `[[scope]]` 프로퍼티를 기반으로 새로운 스코프 체인을 만든다.
