# ch 5 실행 컨텍스트와 클로저

js가 실행 될 때 생성되는 하나의 실행단위인 실행 context, 변수의 유효범위, 클로저를 알아보자.

	- 실행 context의 개념
	- AO와 VO
	- scope chain
	- closure

## 5.1 실행 context 개념

실행 컨텍스트는 실행 가능한 코드를 형상화하고 구분하는 추상적인 개념

즉, 실행 가능한 js코드 블록이 실행되는 환경이다.

그 코드블록은 대부분 함수다.

이 코드블록 안에는 `변수`, `객체`, `실행가능한 코드`가 들어있다.

실행 가능한 코드가 실행되면 또 실행 context가 생긴다.

**이런식으로 실행 context는 스택에 쌓인다.**

제일 위(top)에 위치하는 실행 컨텍스트는 현재 실행되고 있는 컨텍스트다.

---

> 현재 실행되는 context에서 이 컨텍스트와 관련 없는 실행 코드가 실행되면,
> 새로운 context가 생성되어 stack에 들어간다. 제어권은 그 context로 이동한다.

## 5.2 실행 컨텍스트 생성 과정

다음 중요 개념을 알아보자

- VO, AO
- scope chain

### 5.2.1 AO 생성

실행 컨텍스트가 생성되면 js 엔진은 해당 컨텍스트에 필요한 여러가지 정보를 담을 객체를 생성한다. AO라고 부른다.

AO는

	- 매개변수, 사용자 정의 변수 및 객체를 저장할 수 있다.
	- 또한, 새로 만들어진 컨텍스트로 접근 가능하다.

### 5.2.2 arguments 객체 생성

AO는 arguments property로 arguments 객체를 참조한다.

### 5.2.3 scope 생성

**현재 컨텍스트의 유효 범위를 나타내는** `스코프` 정보를 생성한다.

만약 현재 컨텍스트에서 특정 변수에 접근할 경우, 이 리스트를 활용한다.

이 리스트에서 못찾으면 없는거다.

리스트는 `[[scope]]` 프로퍼티인 스코프 체인이다.


### 5.2.4 변수 생성

> AO = VO

1. VO 안에서 호출된 함수 인자는 각 property가 만들어진다.
2. 그리고 그 값이 할당된다. 만약 안넘겨졌다면 undefined
3. 그 다음, 함수 안에 정의된 변수, 객체, 함수가 생성된다.

> 3번쨰 과정에서, 변수 및 내부 함수를 메모리에 `생성만`한다.
초기화는 하지 않는다.
초기화는 각 변수나 함수에 해당 표현식이 실행되기 전까지 이뤄지지 않는다.
그래서 undefined가 할당된다.
* 초기화는 표현식 실행될 때(VO 생성이 다 된 후) 이뤄진다.


### 5.2.5 this 바인딩

마지막으로 this에 값을 할당한다.

요약하자면

1. AO 객체 생성
2. arguments 객체 생성
3. scope 생성
4. 변수 생성
5 bhp] b    '/'. this 바인딩

이 순서다.


### 5.2.6 코드 실행

실행 컨텍스트 생성되고, VO 만들어진 후에, 코드에 있는 표현식 실행이 이뤄진다.

이렇게 실행되면서 변수의 초기화 및 연산, 또다른 함수 실행이 이뤄진다.

---

전역 실행 컨텍스트는

	- arguments 객체가 없다
	- 전역 객체 하나만을 포함하는 스코프 체인이 있다.
	- 전역 코드 실행시, 전역 실행 컨텍스트 생성된다.
	- 이 컨텍스트에서 VO = 전역객체
	- 따라서, 전역적으로 선언된 함수 및 변수는 전역객체의 프로퍼티가 된다.

```javascript
var a = 10;
b = 15;
console.log(window.a +", " window.b); //10, 15
```


## summary

실행 컨텍스트는 js코드 블록이 실행되는 환경이다.

- 코드 블록 안에는 변수, 객체, 실행가능한 코드가 있다.
- 컨텍스트 내부에서 실행 코드가 실행되면, 새로운 컨텍스트가 stack에 쌓인다.


실행 컨텍스트 생성 과정

1. AO 생성
	- 해당 컨텍스트에 필요한 여러가지 정보를 담는 객체 AO를 생성
	- 매개변수, 사용자 정의 변수 및 객체를 저장

2. arguments 객체 생성

3. scope 생성
	- **현재 컨텍스트의 유효 범위를 나타내는 스코프 정보**를 생성한다.
	- 만약 현재 컨텍스트에서 특정 변수에 접근시, 이 리스트를 활용(여기서 없으면 없는거)

4. 변수 생성
	- VO 안에서 호출된 함수 인자는 각 프로퍼티가 만들어진다.
	- 그리고 그 값이 할당된다. 없으면 undefined
	- VO 안에 정의된 변수, 객체, 함수가 생성된다.
	- 중요한 것은 `생성`만 하고 초기화는 하지 않는다. (그래서 undefined 할당 되어있다.)
	- 초기화는 표현식 실행될 때, 즉 **VO 생성이 다 된 후**, 이뤄진다.

5. this 바인딩

1~5번을 통해 실행 컨텍스트와 VO 생성

6. 코드의 표현식 실행

요약하면

1. AO 객체 생성
2. arguments객체 생성
3. scope 생성
4. 변수 생성
5. this 바인딩
6. 코드 실행이다.
