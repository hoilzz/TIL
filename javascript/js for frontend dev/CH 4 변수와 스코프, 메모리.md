# 변수와 스코프, 메모리

> 변수의 원시 값과 참조값
> 실행 컨텍스트의 이해
> 가비지 컬렉션의 이해

## 4.1 원시 값과 참조값

변수는 원시 값과 참조 값 두 가지 타입의 데이터 저장 가능.
- 원시값 : 단순 데이터
- 참조 값 : 여러 값으로 구성되는 객체
  - 참조 값은 메모리에 저장된 객체,


## 4.1.1 동적 프로퍼티
- 참조값을 다룰 때는 언제든 프로퍼티와 메서드를 추가 수정 삭제할 수 있다.

  var person = new Object();
  person.name = "Nicholas"
  alert(person.name); // **Nicholas**


  var name = "Nicholas";
  name.age = 27;
  alert(name.age);  // **undefined**

  문자열 name에 age란 프로퍼티를 정의했다.
  하지만 다음 줄에서 프로퍼티는 없어졌다.
  **동적으로 프로퍼티를 추가할 수 있는 값은 참조 값 뿐이다**


## 4.1.3 매개 변수 전달
변수는 `값, 참조`로 접근 가능. 하지만 매개변수는 오직 `값`으로만 전달
### 매개변수를
- `값` 형태로 넘기면 해당 값은 지역변수에 복사
- `참조` 형태로 넘기면 메모리 상의 위치가 지역변수에 저장. 지역 변수 변경시 함수 바깥에도 해당 변경 내용 반영


## 4.1.4 타입 판별
`typeof`, `instanceof`

### instanceof
변수가 주어진 참조 타입의 인스턴스일 때 true 반환
  person instanceOf Object // person변수가 Object의 인스턴스인가?
  colors instanceof Array

모든 참조 값은 Object의 인스턴스로 정의되어있으므로 항상 true 반환
반면 원시 값은 Object의 인스턴스가 아니므로 false 반환

## 4.2 실행 컨텍스트와 스코프
**execution context** 는 컨텍스트라고 부르며 중요한 개념이다.
- 변수, 함수의 실행 컨텍스트는 다른 데이터에 접근할 수 있는지, 어떻게 행동하는지를 규정한다
- 각 실행 컨텍스트에는 변수 객체가 연결되어 있다. 해당 컨텍스트에서 정의된 모든 변수와 함수는 이 객체에 존재한다.

가장 바깥쪽에 존재하는 실행 컨텍스트는 전역 컨텍스트다.
- 웹 브라우저에서는 이 컨텍스트를 window
  - 전역 변수와 함수는 모두 window 객체의 프로퍼티 및 메서드로 생성

**함수를 호출하면 독자적인 실행 컨텍스트 생성**
- 코드 실행이 함수로 들어갈 때마다 함수의 컨텍스트가 컨텍스트 스택에 쌓인다
- 함수 실행이 끝나면 해당 컨텍스트를 스택에서 꺼내고 컨트롤을 이전 컨텍스트에 반환한다.

컨텍스트에서 코드를 실행하면 변수 객체에 `스코프 체인`이 생성됨
- 스코프 체인의 목적은 실행 컨텍스트가 접근할 수 있는 모든 변수와 함수에 순서를 정의하는 것

#### Summary
- 실행 컨텍스트는 전역 컨텍스트와 함수 컨텍스트 2가지 타입만 있다.

- 스코프 체인은 {} 다
- 지역변수와 전역변수의 개념..

  var color = "blue"
  function changeColor() {
    if (color === "blue") {
      color = "red";
    } else {
      color = "blue"
    }
  }

changeColor()의 스코프 체인에는 2개의 객체가 있다.
1 함수 자체의 변수 객체 (this ==== function changeColor())    2 전역 컨텍스트의 변수 객체 (color)


## 4.2.1 스코프 체인 확장

임시 객체가 생성되는 2가지 경우
1 try-catch문의 catch 블록
2 with 문

두 문장은 모두 스코프 체인 앞에 변수 객체를 추가
- with 문에서는 해당 객체가 스코프 체인에 추가
- catch문은 에러 객체를 선언하는 변수 객체가 생성

  function buildUrl() {
    var qs = "?debug=true";

    with(location) {
      var url = href + qs;
    }
    return url;
  }

- with 문이 location 객체에 적용되므로 location 객체가 스코프 체인에 추가됨
- href를 참조하는 문장은 location.href 변수 참조하는 것
- with 문 내부에서 선언한 변수 url은 함수의 컨텍스트로 편입, 따라서 함수 값으로 반환 가능



## 4.2.2 자바스크립트에는 블록 레벨 스코프가 없다
C에서는 중괄호로 감싼 코드 블록마다 스코프가 생성. 조건에 따라 변수를 정의할 수 있다. 그래서 다음 코드 이상하게 느낄 수 있어

  if (true) {
    var color = "blue"
  }
  alert(color) // 'blue'

변수 color는 if 문 안에서 정의 되었다. C에서는 color는 if문 실행 후 파괴됨.
하지만 **js에서는 변수 선언시 해당 변수를 현재 execution context(위 코드에서는 전역 컨텍스트)에 추가**  
이러한 점은 for문 사용시 중요.

for (var i = 0; i < 10; i++) doSomething(i);
alert(i) // 10

블록 레벨 스코프를 지원하는 언어에서는 for문의 초기화 부분에서 선언한 변수가 오직 for문 컨텍스트 안에서만 존재.
but js에서는 루프 실행 끝난 후에도 존재


### 변수 선언
var를 사용해 선언한 변수는 가장 가까운 컨텍스트에 추가됨. 다음과 같이 변수를 선언하지 않은 채 초기화하면 해당 변수는 자동으로 전역 컨텍스트에 추가됨.

  function add(num1, num2) {
    var sum = num1 + num2;
    return sum;
  }

  var result = add(10, 20); // 30
  alert(sum); // sum은 유효한 변수가 아니다.

sum이라는 지역 변수는 함수 밖에서 접근 불가. var를 생략시 sum에 접근 가능

### Summary
- **위와같은 문제를 예방하기 위해 반드시 var로 변수 선언하 다음 초기화 하기**
- **스트릭트 모드에서는 변수 선언하지 않고 초기화하면 error 발생**
- **블록 레벨 스코프 없다** 근데 function add는 블록 레벨 스코프가 아니다..?
- 블록 레벨 스코프란
- 실행 컨텍스트는 전역 컨텍스트와 함수 컨텍스트 2가지 타입만 있다.

### 식별자 검색

식별자 검색 순서
1 로컬 컨텍스트
2 스코프 체인 따라 검색 계속 (스코프 체인 내부의 객체에 프로토타입 체인이 있으므로 체인 따라 검색할 수도 있다.)
3 전역 컨텍스트 변수 객체에서 찾기
4 없으면 정의 안된걸로 판단

  var color = "blue";
  function getColor() {
    return color;
  }
  alert(getColor()); //blue

  window - color
         - getColor return color


## 4.4 요약
자바스크립트 변수는 `원시 값`, `참조 값` 2가지 형태로 저장 가능
`원시 값` : 불리언, 숫자, 문자열, undefined, null

- 원시값은 고정된 크기를 가지며 스택 메모리에 저장
- 원시 값을 한 변수에서 다른 변수로 복사하면 값자체가 복사됨
- 참조 값은 객체이며 힙 메모리에 저장
- 변수에 참조 값을 저장하면 참조만 저장할 뿐 객체 자체를 저장하는 것 아님
- 참조 값을 한 변수에서 다른 변수로 복사하면 참조만을 복사하므로 같은 객체를 참조
- typeof 연산자는 원시 타입 판별, instanceof 연산자는 값의 참조 타입 판별

원시 값과 참조 값을 가리지 않고 모든 변수는 스코프라고 부르기도 하는 `execution context`에 존재
실행 컨텍스트는
- **변수가 존재하는 기간을 결정**
- **어느코드가 해당 변수에 접근할 수 있는지도 결정**
- 실행 컨텍스트에는 **전역 컨텍스트와 함수 컨텍스트** 가 있다
- 실행 컨텍스트에 진입할 때마다 스코프 체인 만들어지며, 스코프 체인은 변수와 함수 검색할 때 쓰인다.
- 함수 컨텍스트는 해당 스코프에 있는 변수, 해당 스코프를 포함하는 컨텍스트에 있는 변수, 전역 컨텍스트에 있는 변수에 모두 접근 가능
- 전역 컨텍스트는 전역 컨텍스트에 있는 변수와 함수에만 접근 가능. 로컬 컨텍스트에 있는 데이터에 직접적 접근 불가능 
